{"ast":null,"code":"'use strict';\n\nvar deepFreeze = require('../util/deepFreeze');\nvar recycleNodesInto = require('../util/recycleNodesInto');\nvar RelayFeatureFlags = require('../util/RelayFeatureFlags');\nvar hasOverlappingIDs = require('./hasOverlappingIDs');\nvar hasSignificantOverlappingIDs = require('./hasSignificantOverlappingIDs');\nvar RelayReader = require('./RelayReader');\nvar RelayStoreSubscriptions = /*#__PURE__*/function () {\n  function RelayStoreSubscriptions(log, resolverCache) {\n    this._subscriptions = new Set();\n    this.__log = log;\n    this._resolverCache = resolverCache;\n  }\n  var _proto = RelayStoreSubscriptions.prototype;\n  _proto.subscribe = function subscribe(snapshot, callback) {\n    var _this = this;\n    var subscription = {\n      backup: null,\n      callback: callback,\n      snapshot: snapshot,\n      stale: false\n    };\n    var dispose = function dispose() {\n      _this._subscriptions[\"delete\"](subscription);\n    };\n    this._subscriptions.add(subscription);\n    return {\n      dispose: dispose\n    };\n  };\n  _proto.snapshotSubscriptions = function snapshotSubscriptions(source) {\n    var _this2 = this;\n    this._subscriptions.forEach(function (subscription) {\n      if (!subscription.stale) {\n        subscription.backup = subscription.snapshot;\n        return;\n      }\n      var snapshot = subscription.snapshot;\n      var backup = RelayReader.read(source, snapshot.selector, _this2._resolverCache);\n      var nextData = recycleNodesInto(snapshot.data, backup.data);\n      backup.data = nextData;\n      subscription.backup = backup;\n    });\n  };\n  _proto.restoreSubscriptions = function restoreSubscriptions() {\n    this._subscriptions.forEach(function (subscription) {\n      var backup = subscription.backup;\n      subscription.backup = null;\n      if (backup) {\n        if (backup.data !== subscription.snapshot.data) {\n          subscription.stale = true;\n        }\n        subscription.snapshot = {\n          data: subscription.snapshot.data,\n          isMissingData: backup.isMissingData,\n          missingClientEdges: backup.missingClientEdges,\n          missingLiveResolverFields: backup.missingLiveResolverFields,\n          seenRecords: backup.seenRecords,\n          selector: backup.selector,\n          missingRequiredFields: backup.missingRequiredFields,\n          relayResolverErrors: backup.relayResolverErrors\n        };\n      } else {\n        subscription.stale = true;\n      }\n    });\n  };\n  _proto.updateSubscriptions = function updateSubscriptions(source, updatedRecordIDs, updatedOwners, sourceOperation) {\n    var _this3 = this;\n    var hasUpdatedRecords = updatedRecordIDs.size !== 0;\n    this._subscriptions.forEach(function (subscription) {\n      var owner = _this3._updateSubscription(source, subscription, updatedRecordIDs, hasUpdatedRecords, sourceOperation);\n      if (owner != null) {\n        updatedOwners.push(owner);\n      }\n    });\n  };\n  _proto._updateSubscription = function _updateSubscription(source, subscription, updatedRecordIDs, hasUpdatedRecords, sourceOperation) {\n    var backup = subscription.backup,\n      callback = subscription.callback,\n      snapshot = subscription.snapshot,\n      stale = subscription.stale;\n    var hasOverlappingUpdates = hasUpdatedRecords && hasOverlappingIDs(snapshot.seenRecords, updatedRecordIDs);\n    if (!stale && !hasOverlappingUpdates) {\n      return;\n    }\n    var nextSnapshot = hasOverlappingUpdates || !backup ? RelayReader.read(source, snapshot.selector, this._resolverCache) : backup;\n    var nextData = recycleNodesInto(snapshot.data, nextSnapshot.data);\n    nextSnapshot = {\n      data: nextData,\n      isMissingData: nextSnapshot.isMissingData,\n      missingClientEdges: nextSnapshot.missingClientEdges,\n      missingLiveResolverFields: nextSnapshot.missingLiveResolverFields,\n      seenRecords: nextSnapshot.seenRecords,\n      selector: nextSnapshot.selector,\n      missingRequiredFields: nextSnapshot.missingRequiredFields,\n      relayResolverErrors: nextSnapshot.relayResolverErrors\n    };\n    if (process.env.NODE_ENV !== \"production\") {\n      deepFreeze(nextSnapshot);\n    }\n    subscription.snapshot = nextSnapshot;\n    subscription.stale = false;\n    if (nextSnapshot.data !== snapshot.data) {\n      if (this.__log && RelayFeatureFlags.ENABLE_NOTIFY_SUBSCRIPTION) {\n        this.__log({\n          name: 'store.notify.subscription',\n          sourceOperation: sourceOperation,\n          snapshot: snapshot,\n          nextSnapshot: nextSnapshot\n        });\n      }\n      callback(nextSnapshot);\n      return snapshot.selector.owner;\n    }\n    if (RelayFeatureFlags.ENABLE_LOOSE_SUBSCRIPTION_ATTRIBUTION && (stale || hasSignificantOverlappingIDs(snapshot.seenRecords, updatedRecordIDs))) {\n      return snapshot.selector.owner;\n    }\n  };\n  return RelayStoreSubscriptions;\n}();\nmodule.exports = RelayStoreSubscriptions;","map":{"version":3,"names":["deepFreeze","require","recycleNodesInto","RelayFeatureFlags","hasOverlappingIDs","hasSignificantOverlappingIDs","RelayReader","RelayStoreSubscriptions","log","resolverCache","_subscriptions","Set","__log","_resolverCache","_proto","prototype","subscribe","snapshot","callback","_this","subscription","backup","stale","dispose","add","snapshotSubscriptions","source","_this2","forEach","read","selector","nextData","data","restoreSubscriptions","isMissingData","missingClientEdges","missingLiveResolverFields","seenRecords","missingRequiredFields","relayResolverErrors","updateSubscriptions","updatedRecordIDs","updatedOwners","sourceOperation","_this3","hasUpdatedRecords","size","owner","_updateSubscription","push","hasOverlappingUpdates","nextSnapshot","process","env","NODE_ENV","ENABLE_NOTIFY_SUBSCRIPTION","name","ENABLE_LOOSE_SUBSCRIPTION_ATTRIBUTION","module","exports"],"sources":["/Users/joaoluismoraes/Desktop/woovi-challenge/web/node_modules/relay-runtime/lib/store/RelayStoreSubscriptions.js"],"sourcesContent":["'use strict';\n\nvar deepFreeze = require('../util/deepFreeze');\nvar recycleNodesInto = require('../util/recycleNodesInto');\nvar RelayFeatureFlags = require('../util/RelayFeatureFlags');\nvar hasOverlappingIDs = require('./hasOverlappingIDs');\nvar hasSignificantOverlappingIDs = require('./hasSignificantOverlappingIDs');\nvar RelayReader = require('./RelayReader');\nvar RelayStoreSubscriptions = /*#__PURE__*/function () {\n  function RelayStoreSubscriptions(log, resolverCache) {\n    this._subscriptions = new Set();\n    this.__log = log;\n    this._resolverCache = resolverCache;\n  }\n  var _proto = RelayStoreSubscriptions.prototype;\n  _proto.subscribe = function subscribe(snapshot, callback) {\n    var _this = this;\n    var subscription = {\n      backup: null,\n      callback: callback,\n      snapshot: snapshot,\n      stale: false\n    };\n    var dispose = function dispose() {\n      _this._subscriptions[\"delete\"](subscription);\n    };\n    this._subscriptions.add(subscription);\n    return {\n      dispose: dispose\n    };\n  };\n  _proto.snapshotSubscriptions = function snapshotSubscriptions(source) {\n    var _this2 = this;\n    this._subscriptions.forEach(function (subscription) {\n      if (!subscription.stale) {\n        subscription.backup = subscription.snapshot;\n        return;\n      }\n      var snapshot = subscription.snapshot;\n      var backup = RelayReader.read(source, snapshot.selector, _this2._resolverCache);\n      var nextData = recycleNodesInto(snapshot.data, backup.data);\n      backup.data = nextData;\n      subscription.backup = backup;\n    });\n  };\n  _proto.restoreSubscriptions = function restoreSubscriptions() {\n    this._subscriptions.forEach(function (subscription) {\n      var backup = subscription.backup;\n      subscription.backup = null;\n      if (backup) {\n        if (backup.data !== subscription.snapshot.data) {\n          subscription.stale = true;\n        }\n        subscription.snapshot = {\n          data: subscription.snapshot.data,\n          isMissingData: backup.isMissingData,\n          missingClientEdges: backup.missingClientEdges,\n          missingLiveResolverFields: backup.missingLiveResolverFields,\n          seenRecords: backup.seenRecords,\n          selector: backup.selector,\n          missingRequiredFields: backup.missingRequiredFields,\n          relayResolverErrors: backup.relayResolverErrors\n        };\n      } else {\n        subscription.stale = true;\n      }\n    });\n  };\n  _proto.updateSubscriptions = function updateSubscriptions(source, updatedRecordIDs, updatedOwners, sourceOperation) {\n    var _this3 = this;\n    var hasUpdatedRecords = updatedRecordIDs.size !== 0;\n    this._subscriptions.forEach(function (subscription) {\n      var owner = _this3._updateSubscription(source, subscription, updatedRecordIDs, hasUpdatedRecords, sourceOperation);\n      if (owner != null) {\n        updatedOwners.push(owner);\n      }\n    });\n  };\n  _proto._updateSubscription = function _updateSubscription(source, subscription, updatedRecordIDs, hasUpdatedRecords, sourceOperation) {\n    var backup = subscription.backup,\n      callback = subscription.callback,\n      snapshot = subscription.snapshot,\n      stale = subscription.stale;\n    var hasOverlappingUpdates = hasUpdatedRecords && hasOverlappingIDs(snapshot.seenRecords, updatedRecordIDs);\n    if (!stale && !hasOverlappingUpdates) {\n      return;\n    }\n    var nextSnapshot = hasOverlappingUpdates || !backup ? RelayReader.read(source, snapshot.selector, this._resolverCache) : backup;\n    var nextData = recycleNodesInto(snapshot.data, nextSnapshot.data);\n    nextSnapshot = {\n      data: nextData,\n      isMissingData: nextSnapshot.isMissingData,\n      missingClientEdges: nextSnapshot.missingClientEdges,\n      missingLiveResolverFields: nextSnapshot.missingLiveResolverFields,\n      seenRecords: nextSnapshot.seenRecords,\n      selector: nextSnapshot.selector,\n      missingRequiredFields: nextSnapshot.missingRequiredFields,\n      relayResolverErrors: nextSnapshot.relayResolverErrors\n    };\n    if (process.env.NODE_ENV !== \"production\") {\n      deepFreeze(nextSnapshot);\n    }\n    subscription.snapshot = nextSnapshot;\n    subscription.stale = false;\n    if (nextSnapshot.data !== snapshot.data) {\n      if (this.__log && RelayFeatureFlags.ENABLE_NOTIFY_SUBSCRIPTION) {\n        this.__log({\n          name: 'store.notify.subscription',\n          sourceOperation: sourceOperation,\n          snapshot: snapshot,\n          nextSnapshot: nextSnapshot\n        });\n      }\n      callback(nextSnapshot);\n      return snapshot.selector.owner;\n    }\n    if (RelayFeatureFlags.ENABLE_LOOSE_SUBSCRIPTION_ATTRIBUTION && (stale || hasSignificantOverlappingIDs(snapshot.seenRecords, updatedRecordIDs))) {\n      return snapshot.selector.owner;\n    }\n  };\n  return RelayStoreSubscriptions;\n}();\nmodule.exports = RelayStoreSubscriptions;"],"mappings":"AAAA,YAAY;;AAEZ,IAAIA,UAAU,GAAGC,OAAO,CAAC,oBAAoB,CAAC;AAC9C,IAAIC,gBAAgB,GAAGD,OAAO,CAAC,0BAA0B,CAAC;AAC1D,IAAIE,iBAAiB,GAAGF,OAAO,CAAC,2BAA2B,CAAC;AAC5D,IAAIG,iBAAiB,GAAGH,OAAO,CAAC,qBAAqB,CAAC;AACtD,IAAII,4BAA4B,GAAGJ,OAAO,CAAC,gCAAgC,CAAC;AAC5E,IAAIK,WAAW,GAAGL,OAAO,CAAC,eAAe,CAAC;AAC1C,IAAIM,uBAAuB,GAAG,aAAa,YAAY;EACrD,SAASA,uBAAuBA,CAACC,GAAG,EAAEC,aAAa,EAAE;IACnD,IAAI,CAACC,cAAc,GAAG,IAAIC,GAAG,CAAC,CAAC;IAC/B,IAAI,CAACC,KAAK,GAAGJ,GAAG;IAChB,IAAI,CAACK,cAAc,GAAGJ,aAAa;EACrC;EACA,IAAIK,MAAM,GAAGP,uBAAuB,CAACQ,SAAS;EAC9CD,MAAM,CAACE,SAAS,GAAG,SAASA,SAASA,CAACC,QAAQ,EAAEC,QAAQ,EAAE;IACxD,IAAIC,KAAK,GAAG,IAAI;IAChB,IAAIC,YAAY,GAAG;MACjBC,MAAM,EAAE,IAAI;MACZH,QAAQ,EAAEA,QAAQ;MAClBD,QAAQ,EAAEA,QAAQ;MAClBK,KAAK,EAAE;IACT,CAAC;IACD,IAAIC,OAAO,GAAG,SAASA,OAAOA,CAAA,EAAG;MAC/BJ,KAAK,CAACT,cAAc,CAAC,QAAQ,CAAC,CAACU,YAAY,CAAC;IAC9C,CAAC;IACD,IAAI,CAACV,cAAc,CAACc,GAAG,CAACJ,YAAY,CAAC;IACrC,OAAO;MACLG,OAAO,EAAEA;IACX,CAAC;EACH,CAAC;EACDT,MAAM,CAACW,qBAAqB,GAAG,SAASA,qBAAqBA,CAACC,MAAM,EAAE;IACpE,IAAIC,MAAM,GAAG,IAAI;IACjB,IAAI,CAACjB,cAAc,CAACkB,OAAO,CAAC,UAAUR,YAAY,EAAE;MAClD,IAAI,CAACA,YAAY,CAACE,KAAK,EAAE;QACvBF,YAAY,CAACC,MAAM,GAAGD,YAAY,CAACH,QAAQ;QAC3C;MACF;MACA,IAAIA,QAAQ,GAAGG,YAAY,CAACH,QAAQ;MACpC,IAAII,MAAM,GAAGf,WAAW,CAACuB,IAAI,CAACH,MAAM,EAAET,QAAQ,CAACa,QAAQ,EAAEH,MAAM,CAACd,cAAc,CAAC;MAC/E,IAAIkB,QAAQ,GAAG7B,gBAAgB,CAACe,QAAQ,CAACe,IAAI,EAAEX,MAAM,CAACW,IAAI,CAAC;MAC3DX,MAAM,CAACW,IAAI,GAAGD,QAAQ;MACtBX,YAAY,CAACC,MAAM,GAAGA,MAAM;IAC9B,CAAC,CAAC;EACJ,CAAC;EACDP,MAAM,CAACmB,oBAAoB,GAAG,SAASA,oBAAoBA,CAAA,EAAG;IAC5D,IAAI,CAACvB,cAAc,CAACkB,OAAO,CAAC,UAAUR,YAAY,EAAE;MAClD,IAAIC,MAAM,GAAGD,YAAY,CAACC,MAAM;MAChCD,YAAY,CAACC,MAAM,GAAG,IAAI;MAC1B,IAAIA,MAAM,EAAE;QACV,IAAIA,MAAM,CAACW,IAAI,KAAKZ,YAAY,CAACH,QAAQ,CAACe,IAAI,EAAE;UAC9CZ,YAAY,CAACE,KAAK,GAAG,IAAI;QAC3B;QACAF,YAAY,CAACH,QAAQ,GAAG;UACtBe,IAAI,EAAEZ,YAAY,CAACH,QAAQ,CAACe,IAAI;UAChCE,aAAa,EAAEb,MAAM,CAACa,aAAa;UACnCC,kBAAkB,EAAEd,MAAM,CAACc,kBAAkB;UAC7CC,yBAAyB,EAAEf,MAAM,CAACe,yBAAyB;UAC3DC,WAAW,EAAEhB,MAAM,CAACgB,WAAW;UAC/BP,QAAQ,EAAET,MAAM,CAACS,QAAQ;UACzBQ,qBAAqB,EAAEjB,MAAM,CAACiB,qBAAqB;UACnDC,mBAAmB,EAAElB,MAAM,CAACkB;QAC9B,CAAC;MACH,CAAC,MAAM;QACLnB,YAAY,CAACE,KAAK,GAAG,IAAI;MAC3B;IACF,CAAC,CAAC;EACJ,CAAC;EACDR,MAAM,CAAC0B,mBAAmB,GAAG,SAASA,mBAAmBA,CAACd,MAAM,EAAEe,gBAAgB,EAAEC,aAAa,EAAEC,eAAe,EAAE;IAClH,IAAIC,MAAM,GAAG,IAAI;IACjB,IAAIC,iBAAiB,GAAGJ,gBAAgB,CAACK,IAAI,KAAK,CAAC;IACnD,IAAI,CAACpC,cAAc,CAACkB,OAAO,CAAC,UAAUR,YAAY,EAAE;MAClD,IAAI2B,KAAK,GAAGH,MAAM,CAACI,mBAAmB,CAACtB,MAAM,EAAEN,YAAY,EAAEqB,gBAAgB,EAAEI,iBAAiB,EAAEF,eAAe,CAAC;MAClH,IAAII,KAAK,IAAI,IAAI,EAAE;QACjBL,aAAa,CAACO,IAAI,CAACF,KAAK,CAAC;MAC3B;IACF,CAAC,CAAC;EACJ,CAAC;EACDjC,MAAM,CAACkC,mBAAmB,GAAG,SAASA,mBAAmBA,CAACtB,MAAM,EAAEN,YAAY,EAAEqB,gBAAgB,EAAEI,iBAAiB,EAAEF,eAAe,EAAE;IACpI,IAAItB,MAAM,GAAGD,YAAY,CAACC,MAAM;MAC9BH,QAAQ,GAAGE,YAAY,CAACF,QAAQ;MAChCD,QAAQ,GAAGG,YAAY,CAACH,QAAQ;MAChCK,KAAK,GAAGF,YAAY,CAACE,KAAK;IAC5B,IAAI4B,qBAAqB,GAAGL,iBAAiB,IAAIzC,iBAAiB,CAACa,QAAQ,CAACoB,WAAW,EAAEI,gBAAgB,CAAC;IAC1G,IAAI,CAACnB,KAAK,IAAI,CAAC4B,qBAAqB,EAAE;MACpC;IACF;IACA,IAAIC,YAAY,GAAGD,qBAAqB,IAAI,CAAC7B,MAAM,GAAGf,WAAW,CAACuB,IAAI,CAACH,MAAM,EAAET,QAAQ,CAACa,QAAQ,EAAE,IAAI,CAACjB,cAAc,CAAC,GAAGQ,MAAM;IAC/H,IAAIU,QAAQ,GAAG7B,gBAAgB,CAACe,QAAQ,CAACe,IAAI,EAAEmB,YAAY,CAACnB,IAAI,CAAC;IACjEmB,YAAY,GAAG;MACbnB,IAAI,EAAED,QAAQ;MACdG,aAAa,EAAEiB,YAAY,CAACjB,aAAa;MACzCC,kBAAkB,EAAEgB,YAAY,CAAChB,kBAAkB;MACnDC,yBAAyB,EAAEe,YAAY,CAACf,yBAAyB;MACjEC,WAAW,EAAEc,YAAY,CAACd,WAAW;MACrCP,QAAQ,EAAEqB,YAAY,CAACrB,QAAQ;MAC/BQ,qBAAqB,EAAEa,YAAY,CAACb,qBAAqB;MACzDC,mBAAmB,EAAEY,YAAY,CAACZ;IACpC,CAAC;IACD,IAAIa,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,YAAY,EAAE;MACzCtD,UAAU,CAACmD,YAAY,CAAC;IAC1B;IACA/B,YAAY,CAACH,QAAQ,GAAGkC,YAAY;IACpC/B,YAAY,CAACE,KAAK,GAAG,KAAK;IAC1B,IAAI6B,YAAY,CAACnB,IAAI,KAAKf,QAAQ,CAACe,IAAI,EAAE;MACvC,IAAI,IAAI,CAACpB,KAAK,IAAIT,iBAAiB,CAACoD,0BAA0B,EAAE;QAC9D,IAAI,CAAC3C,KAAK,CAAC;UACT4C,IAAI,EAAE,2BAA2B;UACjCb,eAAe,EAAEA,eAAe;UAChC1B,QAAQ,EAAEA,QAAQ;UAClBkC,YAAY,EAAEA;QAChB,CAAC,CAAC;MACJ;MACAjC,QAAQ,CAACiC,YAAY,CAAC;MACtB,OAAOlC,QAAQ,CAACa,QAAQ,CAACiB,KAAK;IAChC;IACA,IAAI5C,iBAAiB,CAACsD,qCAAqC,KAAKnC,KAAK,IAAIjB,4BAA4B,CAACY,QAAQ,CAACoB,WAAW,EAAEI,gBAAgB,CAAC,CAAC,EAAE;MAC9I,OAAOxB,QAAQ,CAACa,QAAQ,CAACiB,KAAK;IAChC;EACF,CAAC;EACD,OAAOxC,uBAAuB;AAChC,CAAC,CAAC,CAAC;AACHmD,MAAM,CAACC,OAAO,GAAGpD,uBAAuB"},"metadata":{},"sourceType":"script","externalDependencies":[]}